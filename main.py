#imports
import os
import torch
from blstm import BLSTM
from use_blstm import train_test
from create_dataset import CodeGadgets
from model_config import model_hyperparameters

def main():
    while True:
        fname = input("Dataset [filename.extension]: ")
        if os.path.exists(fname) == True: #check file exists
            break
        else:
            ftype = os.path.splitext(fname) #splits name and file extension
            if ftype[1] != '.txt': #if file extension is not .txt
                print("%s is an invalid file type. Please try again"%ftype[1])
            else:
                print("Error while accessing the file %s"%fname)
                print("Check the file name is spelt correctly and in the same folder as main.py")
                
    dataset = CodeGadgets(fname, 100)
    ftype = os.path.splitext(fname)
    name = ftype[0]
    device = torch.device("cuda" if torch.cuda.is_available() else "cpu")
    config = model_hyperparameters()
    model = BLSTM(
        config.input_size,
        config.hidden_size,
        config.num_layers,
        config.num_classes,
        config.dropout,
        device,
    ).to(device)
    
    print("Training BLSTM model...")
    use_model = train_test(model, config, name)
    use_model.train(dataset)


if __name__ == "__main__":
    main()
    
